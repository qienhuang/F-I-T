preregistration:
  case_id: afdb_swissprot_tier2p11_confidence_regimes
  pack_version: v1.1_repo_ready
  date_locked: '2026-02-05'
  task:
    tier: tier2p11
    type: topological_event
    proposition: P11
    description: >
      Pilot run on a small, locally downloaded AFDB coordinate set (B0 only).
      This prereg is intended to validate the end-to-end pipeline and artifact
      discipline without requiring a full Swiss-Prot-scale cache.
  success_criteria:
  - Pipeline runs end-to-end producing required artifacts.
  - Output explicitly reports either (a) >=1 detected event or (b) none detected.
  failure_labels:
    estimator_unstable: ESTIMATOR_UNSTABLE
    scope_limited: SCOPE_LIMITED
    boundary_dependent: BOUNDARY_DEPENDENT

boundary:
  afdb_release_version: v6
  dataset_scope: swissprot
  boundary_mode: B0_COORD_ONLY
  formats:
    coords: [cif, pdb]
    pae: [json]
    msa: [a3m]
  paths:
    coords_dir: data/coords
    pae_dir: data/pae
    msa_dir: data/msa
  selection:
    universe_source:
      type: scan_coords_dir
      pattern: AF-<ACCESSION>-*.{cif,pdb}
    sampler:
      type: deterministic_hash
      hash_fn: sha256
      seed_string: FIT_AFDB_pilot_v1
      target_n_valid: 80
      max_draw_multiplier: 5
    filters:
      exclude_fragments_by_name: true
      min_length: 50
      max_length: 2500
  artifact_availability:
    pae_available: false
    msa_available: false

axis:
  type: length_bins
  bin_width_aa: 200
  min_items_per_bin: 1
  binning_rule: inclusive_lower_exclusive_upper

windows:
  smoothing_bins: 3
  event_jump_bins: 2
  event_persist_bins: 2

estimators:
  composites:
    epsilon: 1.0e-06
    norm:
      method: robust_quantile_scale
      lower_q: 0.05
      upper_q: 0.95
      clip_0_1: true
    C_rule_by_boundary:
      B0_COORD_ONLY:
        type: single
        C_ids: [C1_low_conf_frac]

p11_event:
  event_id: E_regime
  delta_R: 0.12
  cooccurrence_required: 2
  signals:
  - id: drop_I1
    delta: 0.08
    metric: I1_hi_conf_frac
    direction: down
  - id: rise_C1
    delta: 0.06
    metric: C1_low_conf_frac
    direction: up

coherence_gate:
  metric: event_alignment
  tolerance_bins: 1
  if_available_compare: [C1_low_conf_frac]
  fail_label: ESTIMATOR_UNSTABLE

outputs:
  out_root: out
  run_id_style: manual
  artifacts:
  - accessions_selected.txt
  - accessions_selected.sha256
  - metrics_per_protein.parquet
  - metrics_per_bin.parquet
  - regime_report.md
  - tradeoff_onepage.pdf
  - boundary_snapshot.json
  - run_manifest.json
  - EST_PREREG.locked.yaml
