# v0.3 Phase A2: FPR–Coverage Tradeoff Analysis

**Date**: January 21, 2026  
**Analysis**: Sweep FPR thresholds to explore coverage vs lead time tradeoff

## Key finding: `score_sign=-1` has uncontrolled FPR (≈0.44)

Interpretation note: for `score_sign=-1`, the table entries below reflect an **FPR floor** (the best achievable operating point). They do **not** satisfy low targets like `FPR=0.05`; rather, they show that the minimum achievable FPR is ~0.44.

### Summary by seed range

| Seed Range | Score Sign | FPR Range Tested | Actual FPR Achieved | Coverage @ target FPR | Lead Time (steps) |
|------------|------------|------------------|---------------------|----------------------|-------------------|
| **100-119** (B1) | **-1** | 0.01 - 0.20 | **0.44 (FPR floor)** | **100%** (but infeasible at low FPR) | 18,775 |
| **100-119** (B1) | **+1** | 0.01 - 0.20 | 0.01 - 0.20 (controlled) | 0% → 85% | 12,071–13,588 |
| **120-139** (B2) | **-1** | 0.01 - 0.20 | **0.44 (FPR floor)** | **95%** (but infeasible at low FPR) | 18,895 |
| **120-139** (B2) | **+1** | 0.01 - 0.20 | 0.01 - 0.20 (controlled) | 0% → 75% | 7,250–15,357 |

## Detailed results

### Phase B1 (seeds 100–119): `score_sign=-1` (problematic)

```
FPR (target)   FPR (actual)   Coverage     N Covered    Mean Lead Time
-------------------------------------------------------------------------------------
0.010          0.4407         100.0%       20/20        18775 steps
0.020          0.4407         100.0%       20/20        18775 steps
0.050          0.4407         100.0%       20/20        18775 steps
0.100          0.4407         100.0%       20/20        18775 steps
0.150          0.4407         100.0%       20/20        18775 steps
0.200          0.4407         100.0%       20/20        18775 steps
```

Problem:

- Cannot achieve `FPR < 0.44` with any threshold under this orientation.
- Coverage is high but not meaningful for low-FPR early warning (too many false positives).

### Phase B1 (seeds 100–119): `score_sign=+1` (normal)

```
FPR (target)   FPR (actual)   Coverage     N Covered    Mean Lead Time
-------------------------------------------------------------------------------------
0.010          0.0100           0.0%        0/20        N/A
0.020          0.0200           0.0%        0/20        N/A
0.050          0.0500          35.0%        7/20        12071 steps
0.100          0.1000          70.0%       14/20        13071 steps
0.150          0.1500          75.0%       15/20        14167 steps
0.200          0.2000          85.0%       17/20        13588 steps
```

### Phase B2 (seeds 120–139): `score_sign=-1` (problematic)

```
FPR (target)   FPR (actual)   Coverage     N Covered    Mean Lead Time
-------------------------------------------------------------------------------------
0.010          0.4442          95.0%       19/20        18895 steps
0.020          0.4442          95.0%       19/20        18895 steps
0.050          0.4442          95.0%       19/20        18895 steps
0.100          0.4442          95.0%       19/20        18895 steps
0.150          0.4442          95.0%       19/20        18895 steps
0.200          0.4442          95.0%       19/20        18895 steps
```

### Phase B2 (seeds 120–139): `score_sign=+1` (normal)

```
FPR (target)   FPR (actual)   Coverage     N Covered    Mean Lead Time
-------------------------------------------------------------------------------------
0.010          0.0100           0.0%        0/20        N/A
0.020          0.0200          10.0%        2/20        7250 steps
0.050          0.0500          35.0%        7/20        15357 steps
0.100          0.1000          65.0%       13/20        11769 steps
0.150          0.1500          70.0%       14/20        14857 steps
0.200          0.2000          75.0%       15/20        15000 steps
```

## Coverage vs FPR (for `score_sign=+1`)

| FPR Threshold | Coverage (B1) | Coverage (B2) | Average Coverage | Lead Time |
|--------------|--------------|--------------|-----------------|-----------|
| 0.01 | 0% | 0% | 0% | N/A |
| 0.02 | 0% | 10% | 5% | ~7k steps |
| **0.05** | **35%** | **35%** | **35%** | **12–15k steps** |
| **0.10** | **70%** | **65%** | **67.5%** | **12–14k steps** |
| 0.15 | 75% | 70% | 72.5% | 14–15k steps |
| 0.20 | 85% | 75% | 80% | 13–15k steps |

## Interpretation

This directly explains why v0.2.1 could show “mean AUC ≈ 0.50” while still having non-zero alarm coverage at `score_sign=+1`, and why `score_sign=-1` can produce the opposite behavior (better ranking metrics but unusable low-FPR alarms).

The core point is objective mismatch:

- **Ranking-style metrics** (ROC-AUC / AP) measure ordering quality.
- **Alarm-style operation** requires an achievable low-FPR threshold with non-trivial coverage.

## Reproduction commands (Mac)

```bash
cd "/Users/qienhuang/Downloads/FIT Lab/grokking"

# Phase B1 (seeds 100-119)
.venv/bin/python -m grokking.analysis.fpr_tradeoff_curves --runs_dir runs_v0.2/eval --score_sign=+1
.venv/bin/python -m grokking.analysis.fpr_tradeoff_curves --runs_dir runs_v0.2/eval --score_sign=-1

# Phase B2 (seeds 120-139)
.venv/bin/python -m grokking.analysis.fpr_tradeoff_curves --runs_dir runs_v0.2_1/eval --score_sign=+1
.venv/bin/python -m grokking.analysis.fpr_tradeoff_curves --runs_dir runs_v0.2_1/eval --score_sign=-1
```
